{%extends 'layout/layout.html'%}
{%block title%}Read Lyrics{%endblock%}
{%block content%}

<div class="container  px-0 mt-10 mx-auto w-screen flex justify-center items-center">
    <div class="component1   border-2 border-gray-200 rounded-lg p-4" style="margin: 5vh; width: 70vw; height: 70vh; display: flex; flex-direction: column;">
        <div class="text-2xl text-gray-900 mb-2" style="display: flex; justify-content: space-between; align-items: center;">
            <div class="font-bold text-lg" style="font-size:30px; font-family: cursive;">{{song.songname}}</div>

            
            <audio id="myAudio" controls>
                <source src="{{ url_for('uploaded_file', filename=song_file) }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>


            <button id="playPauseBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" style="height: 42px; text-align: center; align-items: center; padding: 8px 50px;" onclick="togglePlayPause()">
                <span id="btnText" style="font-size: 14px; white-space: nowrap; overflow: hidden;display: inline-block; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Play</span>
            </button>
            
            <script>
                var audio = document.getElementById('myAudio');
                var btnText = document.getElementById('btnText');
            
                function togglePlayPause() {
                    if (audio.paused ) {
                        audio.play();
                        btnText.innerText = 'Pause';
                    } 
                    else {
                        audio.pause();
                        btnText.innerText = 'Play';
                    }
                }
            </script>
            
            
            
            
            
            
            <!-- Rating -->
            <div class="flex items-center">
                <svg class="w-4 h-4 {%if rating<1%}text-gray-300{%else%}text-yellow-300{%endif%} ms-1" id="1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20" onclick="updateRating(1)">
                    <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                </svg>
                <svg class="w-4 h-4 {%if rating<2%}text-gray-300{%else%}text-yellow-300{%endif%} ms-1" id="2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20" onclick="updateRating(2)">
                    <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                </svg>
                <svg class="w-4 h-4 {%if rating<3%}text-gray-300{%else%}text-yellow-300{%endif%} ms-1" id="3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20" onclick="updateRating(3)">
                    <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                </svg>
                <svg class="w-4 h-4 {%if rating<4%}text-gray-300{%else%}text-yellow-300{%endif%} ms-1" id="4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20" onclick="updateRating(4)">
                    <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                </svg>
                <svg class="w-4 h-4 {%if rating<5%}text-gray-300{%else%}text-yellow-300{%endif%} ms-1" id="5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20" onclick="updateRating(5)">
                    <path d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z"/>
                </svg>
            </div>

        </div>

        

        <div style="display: flex; justify-content: flex-start;">
            <code><div class="font text-lg" style="font-size:16px;">{{song.artist}}</div></code>
            <span style="margin: 8px; color: #87CEEB; border-right: 1px solid #87CEEB;"></span>
            <code><div class="font text-lg" style="font-size:16px;">{{song.year}}</div></code>
        </div>
        <!-- <h2 class="text-sm tracking-widest title-font mb-1 font-medium text-center" style="margin-top:20px;">No Songs Added in this Playlist</h2> -->
        
        <div class="bg-orange-100 component1  border-2 border-gray-200 rounded-lg p-4 overflow-auto" style="flex: 1;">
            <pre>{{lyrics}}</pre>
        </div>
        
        <div style="display: flex; justify-content: flex-start;">
            <a  onclick="showCommentPopup()" style="text-decoration: none; color: #87CEEB;">Comment</a>
        </div>


<div id="commentPopup" style="display: none;" class="p-2 w-full">
    <form id="commentForm" onsubmit="submitComment(event)">
        <div class="relative">
            <textarea id="commentInput" placeholder="Enter your comment" name="address" class="w-full bg-gray-100 bg-opacity-50 rounded border border-gray-300 focus:border-indigo-500 focus:bg-white focus:ring-2 focus:ring-indigo-200 h-32 text-base outline-none text-gray-700 py-1 px-3 resize-none leading-6 transition-colors duration-200 ease-in-out" required></textarea>
            
        </div>
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" style="height: 42px; text-align: center; align-items: center; padding: 8px 50px;" >
            Submit
        </button>
    </form>
  </div>



    </div>
</div>

<script>
    function updateRating(rating) {
        for (var i = 1; i <= rating; i++) {
            document.getElementById(i).style.color = "rgb(252,220,56)";
        }
        for (var i = rating + 1; i <= 5; i++) {
            document.getElementById(i).style.color = "rgb(198,203,211)";
        }
        var song_id = '{{ song.songid }}';
        fetch('/update_rating', {
            method: 'POST',
            body: JSON.stringify({
                song_id: song_id,
                rating: rating
            })
        })
    }


    function showCommentPopup() {
        if (document.getElementById('commentPopup').style.display == 'block') {
            document.getElementById('commentPopup').style.display = 'none';
            return;
        }
        document.getElementById('commentPopup').style.display = 'block';
    }

    function submitComment(event) {
        event.preventDefault();
        const comment = document.getElementById('commentInput').value;
        const song_id = '{{ song.songid }}'; // Define song_id here or ensure it's accessible within this function
        
        // Send comment to Python backend
        fetch('/submit_comment', {
            method: 'POST',
            body: JSON.stringify({ song_id: song_id, comment: comment })
        })
        .then(response => {
            // Handle response if needed
            console.log('Comment submitted:', response);
        })
        .catch(error => {
            // Handle error if needed
            console.error('Error:', error);
        });
    
        // Hide the comment popup after submission
        document.getElementById('commentPopup').style.display = 'none';
    }
    

</script>

<div class="container mb-10 px-0  mx-auto w-screen flex justify-center items-center">
    <div class="component1 border-2 border-gray-200 rounded-lg p-4" style="width: 70vw; height: 40vh; display: flex; flex-direction: column;">
        <div class="text-2xl text-gray-900 -mb-8" style="display: flex; justify-content: space-between; align-items: center;">
            
        <div class="text-2xl text-gray-900  " style="display: flex; justify-content: space-between; align-items: center;">
            <div class="font-bold text-lg" style="font-size:30px; font-family: cursive;">Comments</div>
          
  
        </div>
        </div>
        {%if comments ==[]%}
        <h2 class="text-sm tracking-widest title-font mb-1 font-medium text-center" style="margin-top:20px;">No Comments Were Posted</h2>
        
        {%else%}
            <div style="margin-top: 40px;height: 40vh; overflow-y: auto;">
            {%for comment in comments%}
            
                <div class="bg-gray-100 component1 border-2 border-gray-200 rounded-lg p-2" style="margin-bottom: 20px;">
                    <div class="font-bold text-lg">{%for user in user%}{%if comment.userid==user.userid%}{{user.uname}}{%endif%}{%endfor%}:</div>
                <label for="myAudio" class="text-2xl text-gray-900 mb-0 flex justify-between items-center cursor-pointer">
                    <div class=" text-lg">{{comment.comment}}</div>
                </label>
                </div>
            {%endfor%}
      
        </div>
      {%endif%}
        
  
    </div>
  </div>

{%endblock%}